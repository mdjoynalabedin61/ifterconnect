<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="theme-color" content="#1E1E1E">
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=instant_mix" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"/>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"/>
    
<link rel="stylesheet" href="styles.css">
<link rel="manifest" href="manifest.json">
<style>
    
#loader-wrapper {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: #105D4D;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 999999999;
}


.loader {
    border: 8px solid #f3f3f3;
    border-top: 8px solid #3498db;
    border-radius: 50%;
    width: 60px;
    height: 60px;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}


</style>
</head>
<body>
<div id="loader-wrapper">
        <div class="loader"></div>
        <p style="margin-top:10px;color:white">рж▓рзЛржб рж╣ржЪрзНржЫрзЗ...</p>
        <p style="margin-top:-5px;color:white">ржЕржирзБржЧрзНрж░рж╣ржкрзВрж░рзНржмржХ ржЕржкрзЗржХрзНрж╖рж╛ ржХрж░рзБржи...</p>
    </div>
    
    
<div class="topNavbar">
<div class="leftside">
<div class="words">
<span>ржкрж╛ржмржирж╛ ржЬрзЗрж▓рж╛рж░ ржЬржирзНржпред</span>
<span id="dateText">рждрж╛рж░рж┐ржЦ рж▓рзЛржбрж┐ржВ...</span>
<span id="dayText">ржмрж╛рж░ рж▓рзЛржбрж┐ржВ...</span>
<span id="ramadanText">рж░рзЛржЬрж╛ рж▓рзЛржбрж┐ржВ...</span>
<span id="sehriVal">рж╕рзЗрж╣рж░рж┐: --:--</span>
<span id="iftarVal">ржЗржлрждрж╛рж░: --:--</span>

<span>ржкрж╛ржмржирж╛ ржЬрзЗрж▓рж╛рж░ ржЬржирзНржп</span>
</div>
</div>
<div class="righside">
<p id="timerLabel">
ржЕржкрзЗржХрзНрж╖рж╛ ржХрж░рзБржи
</p>
<p id="ifterandsehritime">
рзжрзж:рзжрзж:рзжрзж
</p>
</div>
</div>

<div id="map"></div>

<div class="search-box">
<input type="text" id="searchInput" placeholder="ржорж╕ржЬрж┐ржж ржмрж╛ ржПрж▓рж╛ржХрж╛ ржЦрзБржБржЬрзБржи...">
<button id="searchBtn"><span class="material-symbols-outlined">
map_search
</span> ржЦрзБржБржЬрзБржи</button>
</div>

<button class="fabbuttontwo show-modal" id="fabbuttontwo"><span class="material-symbols-outlined">
instant_mix
</span></button>

<button class="fab" id="openAddBtn">+</button>

<div id="add-form" style="margin-top:20px">
   <span class="material-symbols-outlined"style="position:fixed;right:10px;top:10px;background-color:#dddddd;border-radius:50%"id="cancelBtnTwo">close
</span>
<h3 style="margin-top:10px; color:#2e7d32;">ржЗржлрждрж╛рж░рзЗрж░ рж╕рзНржерж╛ржи</h3>
<p style="font-size:10px;color:#444444">ржПржЗ ржорзНржпрж╛ржкрзЗрж░ рж╕рзАржорж╛ржирж╛ ржХрзЗржмрж▓ ржкрж╛ржмржирж╛ ржЬрзЗрж▓рж╛рж░ ржЬржирзНржп ржкрзНрж░ржпрзЛржЬрзНржпред ржкрзНрж░рзЯрзЛржЬржирзАрзЯ рждржерзНржп ржкрзВрж░ржг ржХрж░рзЗ, "ржкрзЯрзЗржирзНржЯ рж╕рзЗржЯ ржХрж░рзБржи" ржмрж╛ржЯржирзЗ ржХрзНрж▓рж┐ржХ ржХрж░рзЗ рж╕рзЗржЯ ржХрж░рзБржи ржпрзЗржЦрж╛ржирзЗ ржЗржлрждрж╛рж░ ржЖрзЯрзЛржЬржирзЗрж░ ржЧржирзНрждржмрзНржп </p>
<hr>


            <div class="input-box" style="margin-top:2px">
            <input id="placeName" type="text" required="true" placeholder="">
            <span>ржорж╕ржЬрж┐ржж/ржкрзНрж░рждрж┐рж╖рзНржарж╛ржирзЗрж░ ржирж╛ржо *</span>
        </div>





            <div class="input-box">
            <input id="isthanerNamearea" type="text" required="true" placeholder="">
            <span>рж╕рзНржерж╛ржирзЗрж░ ржирж╛ржо *</span>
        </div>


          <div class="input-box" style="margin-top:2px">
            <input type="date" id="todaydate" required="true" placeholder="">
            <span>рждрж╛рж░рж┐ржЦ *</span>
        </div>


<select id="iftariOption" style="width:100%;height:50px;outline:none;border:1.5px solid #ddd;border-radius:10px;font-size:15px;color:#444444">
    <option value="">ржЗржлрждрж╛рж░ ржЖржЗржЯрзЗржо</option>
    <option value="biriyani">ржмрж┐рж░рж┐ржпрж╝рж╛ржирж┐(Biriyani)</option>
      <option value="Chaines">ржЪрж╛ржЗржирж┐ржЬ(Chinese)</option>
      <option value="Mixed(ржорж┐рж╢рзНрж░)"> Mixed(ржорж┐рж╢рзНрж░)</option>
</select>
            




          <div class="input-box" style="margin-top:5px">
            <input id="descriptiontopic" type="text" required="true" placeholder="">
            <span>ржХрж┐ржЫрзБ ржХржерж╛(ржмрж╛ржВрж▓рж╛)(ржРржЪрзНржЫрж┐ржХ) *</span>
        </div>





<button id="startAddBtn" style="width:100%; background:#2e7d32; color:white; border:none; padding:12px; border-radius:8px; cursor:pointer; font-weight:bold;">ржкрзЯрзЗржирзНржЯ рж╕рзЗржЯ ржХрж░рзБржи</button>
<button id="cancelBtn" style="margin-top:10px; background:none; border:none; color:red; cursor:pointer;">ржмрж╛рждрж┐рж▓</button>

<div class="hr" style="width:80%;height:2px;background-color:#dddddd;margin:10px 0px;display:flex;margin:0 auto"></div>
<p>Developed with тЭдя╕П by
<a href="https://www.facebook.com/joynal.abedin.9987" style="text-decoration:none;color:green">Mohammad Joynal Abedin</a></p>
</div>

    <div class="bottom-sheet">
      <div class="sheet-overlay"></div>
      <div class="content">
        <div class="header">
          <div class="drag-icon">
              <span></span>

          </div>
                    <div class="toplineOfbottomsheet" style="padding:10px;display:flex;justify-content:space-between;gap:10px">
              <button>ржЖржЬ</button>
<button>ржЖржЧрж╛ржорзАржХрж╛рж▓</button>
<button>ржкрж░рж╢рзБ</button>
<button>Near by me</button>
          </div>
        </div>
        <div class="body">
       

        </div>
      </div>
    </div>




<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script type="module">
import {
initializeApp
} from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import {
getDatabase,
ref,
push,
onChildAdded,
onValue,
update,
increment
} from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";

const firebaseConfig = {
apiKey: "AIzaSyCkQVG3RNs1_ocM8FMTVKp4WCNjoPYU-5E",
authDomain: "ifter-92369.firebaseapp.com",
databaseURL: "https://ifter-92369-default-rtdb.firebaseio.com/",
projectId: "ifter-92369",
storageBucket: "ifter-92369.firebasestorage.app",
messagingSenderId: "918071750755",
appId: "1:918071750755:web:3733694c4e9e56fcfa0856"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const placesRef = ref(db, 'iftar_places');


function getDistance(lat1, lon1, lat2, lon2) {
    const R = 6371; // ржкрзГржерж┐ржмрзАрж░ ржмрзНржпрж╛рж╕рж╛рж░рзНржз (km)
    const dLat = (lat2 - lat1) * Math.PI / 180;
    const dLon = (lon2 - lon1) * Math.PI / 180;
    const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
              Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
              Math.sin(dLon / 2) * Math.sin(dLon / 2);
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
    return R * c; 
}







const pabnaCenter = [24.0114, 89.2448];
const pabnaBounds = [[23.7500, 88.8500], [24.3500, 89.6500]];

const map = L.map('map', {
center: pabnaCenter,
zoom: 13,
minZoom: 10,
maxBounds: pabnaBounds,
maxBoundsViscosity: 1.0
 });




L.tileLayer('http://{s}.google.com/vt/lyrs=y&x={x}&y={y}&z={z}', {
maxZoom: 20, subdomains: ['mt0', 'mt1', 'mt2', 'mt3']
}).addTo(map);




const ramadanData = [
  { "date": "рззрзп ржлрзЗржмрзНрж░рзБржпрж╝рж╛рж░рж┐", "dayname": "ржмрзГрж╣рж╕рзНржкрждрж┐ржмрж╛рж░", "ramzan": "рзжрзз", "sehri": "05:15:00", "iftar": "18:01:00" },
  { "date": "рзирзж ржлрзЗржмрзНрж░рзБржпрж╝рж╛рж░рж┐", "dayname": "рж╢рзБржХрзНрж░ржмрж╛рж░", "ramzan": "рзжрзи", "sehri": "05:14:00", "iftar": "18:02:00" },
  { "date": "рзирзз ржлрзЗржмрзНрж░рзБржпрж╝рж╛рж░рж┐", "dayname": "рж╢ржирж┐ржмрж╛рж░", "ramzan": "рзжрзй", "sehri": "05:14:00", "iftar": "18:03:00" },
  { "date": "рзирзи ржлрзЗржмрзНрж░рзБржпрж╝рж╛рж░рж┐", "dayname": "рж░ржмрж┐ржмрж╛рж░", "ramzan": "рзжрзк", "sehri": "05:13:00", "iftar": "18:03:00" },
  { "date": "рзирзй ржлрзЗржмрзНрж░рзБржпрж╝рж╛рж░рж┐", "dayname": "рж╕рзЛржоржмрж╛рж░", "ramzan": "рзжрзл", "sehri": "05:12:00", "iftar": "18:04:00" },
  { "date": "рзирзк ржлрзЗржмрзНрж░рзБржпрж╝рж╛рж░рж┐", "dayname": "ржоржЩрзНржЧрж▓ржмрж╛рж░", "ramzan": "рзжрзм", "sehri": "05:12:00", "iftar": "18:04:00" },
  { "date": "рзирзл ржлрзЗржмрзНрж░рзБржпрж╝рж╛рж░рж┐", "dayname": "ржмрзБржзржмрж╛рж░", "ramzan": "рзжрзн", "sehri": "05:11:00", "iftar": "18:05:00" },
  { "date": "рзирзм ржлрзЗржмрзНрж░рзБржпрж╝рж╛рж░рж┐", "dayname": "ржмрзГрж╣рж╕рзНржкрждрж┐ржмрж╛рж░", "ramzan": "рзжрзо", "sehri": "05:10:00", "iftar": "18:05:00" },
  { "date": "рзирзн ржлрзЗржмрзНрж░рзБржпрж╝рж╛рж░рж┐", "dayname": "рж╢рзБржХрзНрж░ржмрж╛рж░", "ramzan": "рзжрзп", "sehri": "05:09:00", "iftar": "18:06:00" },
  { "date": "рзирзо ржлрзЗржмрзНрж░рзБржпрж╝рж╛рж░рж┐", "dayname": "рж╢ржирж┐ржмрж╛рж░", "ramzan": "рззрзж", "sehri": "05:08:00", "iftar": "18:06:00" },
  { "date": "рзз ржорж╛рж░рзНржЪ", "dayname": "рж░ржмрж┐ржмрж╛рж░", "ramzan": "рззрзз", "sehri": "05:08:00", "iftar": "18:07:00" },
  { "date": "рзи ржорж╛рж░рзНржЪ", "dayname": "рж╕рзЛржоржмрж╛рж░", "ramzan": "рззрзи", "sehri": "05:07:00", "iftar": "18:07:00" },
  { "date": "рзй ржорж╛рж░рзНржЪ", "dayname": "ржоржЩрзНржЧрж▓ржмрж╛рж░", "ramzan": "рззрзй", "sehri": "05:06:00", "iftar": "18:08:00" },
  { "date": "рзк ржорж╛рж░рзНржЪ", "dayname": "ржмрзБржзржмрж╛рж░", "ramzan": "рззрзк", "sehri": "05:05:00", "iftar": "18:08:00" },
  { "date": "рзл ржорж╛рж░рзНржЪ", "dayname": "ржмрзГрж╣рж╕рзНржкрждрж┐ржмрж╛рж░", "ramzan": "рззрзл", "sehri": "05:04:00", "iftar": "18:09:00" },
  { "date": "рзм ржорж╛рж░рзНржЪ", "dayname": "рж╢рзБржХрзНрж░ржмрж╛рж░", "ramzan": "рззрзм", "sehri": "05:03:00", "iftar": "18:09:00" },
  { "date": "рзн ржорж╛рж░рзНржЪ", "dayname": "рж╢ржирж┐ржмрж╛рж░", "ramzan": "рззрзн", "sehri": "05:02:00", "iftar": "18:10:00" },
  { "date": "рзо ржорж╛рж░рзНржЪ", "dayname": "рж░ржмрж┐ржмрж╛рж░", "ramzan": "рззрзо", "sehri": "05:01:00", "iftar": "18:10:00" },
  { "date": "рзп ржорж╛рж░рзНржЪ", "dayname": "рж╕рзЛржоржмрж╛рж░", "ramzan": "рззрзп", "sehri": "05:01:00", "iftar": "18:11:00" },
  { "date": "рззрзж ржорж╛рж░рзНржЪ", "dayname": "ржоржЩрзНржЧрж▓ржмрж╛рж░", "ramzan": "рзирзж", "sehri": "05:00:00", "iftar": "18:11:00" },
  { "date": "рззрзз ржорж╛рж░рзНржЪ", "dayname": "ржмрзБржзржмрж╛рж░", "ramzan": "рзирзз", "sehri": "04:59:00", "iftar": "18:11:00" },
  { "date": "рззрзи ржорж╛рж░рзНржЪ", "dayname": "ржмрзГрж╣рж╕рзНржкрждрж┐ржмрж╛рж░", "ramzan": "рзирзи", "sehri": "04:58:00", "iftar": "18:12:00" },
  { "date": "рззрзй ржорж╛рж░рзНржЪ", "dayname": "рж╢рзБржХрзНрж░ржмрж╛рж░", "ramzan": "рзирзй", "sehri": "04:57:00", "iftar": "18:12:00" },
  { "date": "рззрзк ржорж╛рж░рзНржЪ", "dayname": "рж╢ржирж┐ржмрж╛рж░", "ramzan": "рзирзк", "sehri": "04:56:00", "iftar": "18:13:00" },
  { "date": "рззрзл ржорж╛рж░рзНржЪ", "dayname": "рж░ржмрж┐ржмрж╛рж░", "ramzan": "рзирзл", "sehri": "04:55:00", "iftar": "18:13:00" },
  { "date": "рззрзм ржорж╛рж░рзНржЪ", "dayname": "рж╕рзЛржоржмрж╛рж░", "ramzan": "рзирзм", "sehri": "04:54:00", "iftar": "18:14:00" },
  { "date": "рззрзн ржорж╛рж░рзНржЪ", "dayname": "ржоржЩрзНржЧрж▓ржмрж╛рж░", "ramzan": "рзирзн", "sehri": "04:53:00", "iftar": "18:14:00" },
  { "date": "рззрзо ржорж╛рж░рзНржЪ", "dayname": "ржмрзБржзржмрж╛рж░", "ramzan": "рзирзо", "sehri": "04:52:00", "iftar": "18:14:00" },
  { "date": "рззрзп ржорж╛рж░рзНржЪ", "dayname": "ржмрзГрж╣рж╕рзНржкрждрж┐ржмрж╛рж░", "ramzan": "рзирзп", "sehri": "04:51:00", "iftar": "18:15:00" },
  { "date": "рзирзж ржорж╛рж░рзНржЪ", "dayname": "рж╢рзБржХрзНрж░ржмрж╛рж░", "ramzan": "рзйрзж", "sehri": "04:50:00", "iftar": "18:15:00" }
];



function convertTo12HourFormat(time) {
    if (!time) return "N/A";
    let [hour,
        minute] = time.split(":").map(Number);
    let period = hour >= 12 ? "PM": "AM";
    hour = hour % 12 || 12;
    return `${hour}:${minute.toString().padStart(2, '0')} ${period}`;
}



    function updateClock() {
        const now = new Date();
        const options = { day: 'numeric', month: 'long' };
        
        
        let todayStr = now.toLocaleDateString('bn-BD', options).replace(/,/g, '');
        todayStr = todayStr.replace("ржлрзЗржмрзНрж░рзБржпрж╝рж╛рж░рзА", "ржлрзЗржмрзНрж░рзБржпрж╝рж╛рж░рж┐"); 
        
        const dayName = now.toLocaleDateString('bn-BD', { weekday: 'long' });

        
        const todayData = ramadanData.find(d => d.date.trim() === todayStr.trim());

        if (!todayData) {
            document.getElementById('ifterandsehritime').innerText = "ржЖржЬ ржХрзЛржирзЛ рж░рзЛржЬрж╛ ржирзЗржЗ";
            return;
        }


        document.getElementById('dateText').innerText ="ржЖржЬ " + todayStr + " рзирзжрзирзм";
        document.getElementById('dayText').innerText = "рж░рзЛржЬ " + dayName;
        document.getElementById('ramadanText').innerText = todayData.ramzan + " рждржо рж░рзЛржЬрж╛";
document.getElementById('sehriVal').innerText = "рж╕рж╛рж╣рж░рзАржГ "+ convertTo12HourFormat(todayData.sehri) + " рж╕ржорзЯ";
document.getElementById('iftarVal').innerText ="ржЗржлрждрж╛рж░ржГ " + convertTo12HourFormat(todayData.iftar) + " " + " рж╕ржорзЯ";




            const sehriTime = new Date(now.toDateString() + " " + todayData.sehri);
        const iftarTime = new Date(now.toDateString() + " " + todayData.iftar);

        let label = "";
        let displayTime = "";

        if (now < sehriTime) {
            label = "рж╕рзЗрж╣рж░рж┐рж░ ржмрж╛ржХрж┐";
            displayTime = formatDiff(sehriTime - now);
        } else if (now < iftarTime) {
            label = "ржЗржлрждрж╛рж░рзЗрж░ ржмрж╛ржХрж┐";
            displayTime = formatDiff(iftarTime - now);
        } else {

        label = "ржЖржЧрж╛ржорзА рж╕рзЗрж╣рж░рж┐рж░ ржмрж╛ржХрж┐";
    
    
    const nextSehriTime = new Date(sehriTime);
    nextSehriTime.setDate(nextSehriTime.getDate() + 1);
    displayTime = formatDiff(nextSehriTime - now);

            
        }

        document.getElementById('timerLabel').innerText = label;
        document.getElementById('ifterandsehritime').innerText = displayTime;
    }

    function formatDiff(ms) {
        const hours = Math.floor(ms / (1000 * 60 * 60));
        const minutes = Math.floor((ms % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((ms % (1000 * 60)) / 1000);
        
        const toBn = (n) => n.toString().padStart(2, '0').replace(/\d/g, d => "рзжрззрзирзйрзкрзлрзмрзнрзорзп"[d]);
        return `${toBn(hours)} ржШржгрзНржЯрж╛ ${toBn(minutes)} ржорж┐ржирж┐ржЯ ${toBn(seconds)} рж╕рзЗржХрзЗржирзНржб`;
    }

    setInterval(updateClock, 1000);
    updateClock();








let isAdding = false;
document.getElementById('openAddBtn').onclick = () => document.getElementById('add-form').style.display = 'block';
document.getElementById('cancelBtn').onclick = () => {
document.getElementById('add-form').style.display = 'none'; isAdding = false;
};

document.getElementById('cancelBtnTwo').onclick = () => {
document.getElementById('add-form').style.display = 'none';;
};




document.getElementById('startAddBtn').onclick = () => {
isAdding = true; document.getElementById('add-form').style.display = 'none'; alert("ржпрзЗржЗ рж╕рзНржерж╛ржирзЗ ржЗржлрждрж╛рж░, рж╕ржарж┐ржХ рж╕рзЗржЗ рж╕рзНржерж╛ржирзЗржЗ ржХрзНрж▓рж┐ржХ ржХрж░рзБржи,ржкрзНрж░ржпрж╝рзЛржЬржирзЗ рж╕рж╛рж░рзНржЪ ржХрж░рзЗржУ рж╕рзНржерж╛ржиржЯрж┐ рж╕ржирж╛ржХрзНржд ржХрж░рждрзЗ ржкрж╛рж░рзЗржи ред┬а ржЕрждржГржкрж░  ржХрж╛ржЩрзНржЦрж┐ржд ржХрзНрж▓рж┐ржХ ржХрж░рзБржиред ржХрзНрж▓рж┐ржХ ржХрж░рж▓рзЗ рж╕рзНржерж╛ржиржЯрж┐ рж╕рж┐рж▓рзЗржХрзНржЯ рж╣рзЯрзЗ ржпрж╛ржмрзЗред ");
};

map.on('click', (e) => {
if (isAdding) {
    
const name = document.getElementById('placeName').value || "ржорж╕ржЬрж┐ржж";
const isthanerNamearea = document.getElementById("isthanerNamearea").value;
const todaydate = document.getElementById('todaydate').value;
const descriptiontopic = document.getElementById('descriptiontopic').value;
const iftariOption = document.getElementById('iftariOption').value;

push(placesRef, {
name,isthanerNamearea,todaydate,descriptiontopic,iftariOption, lat: e.latlng.lat, lng: e.latlng.lng, upvotes: 0, downvotes: 0
});
isAdding = false; alert("ржпрзЛржЧ рж╣ржпрж╝рзЗржЫрзЗ!");
}
});





onChildAdded(placesRef, (snapshot) => {
const data = snapshot.val();
const key = snapshot.key;


const marker = L.marker([data.lat, data.lng]).addTo(map);

const updatePopup = (up, down) => {
const userChoice = localStorage.getItem(`choice_${key}`); 

const div = document.createElement('div');

div.innerHTML = `
<div class="iftar-card">
<div class="iftar-header">
<div class="iftar-info">
<h3>${data.name}</h3>
<p>${data.isthanerNamearea}</p>
<p>${data.todaydate}</p>
<p><strong>ржЗржлрждрж╛рж░:</strong>${data.iftariOption}</p>
<p>ржЕржХрзНрж╖рж╛ржВрж╢ (Latitude)<strong>${data.lat}</strong></p>
<p>ржжрзНрж░рж╛ржШрж┐ржорж╛ржВрж╢ (Longitude)<strong>${data.lng}</strong></p>
</div>

</div>

<div class="vote-section">
<button class="v-btn upvote ${userChoice === 'up' ? 'active-up': ''}" id="ubtn-${key}">
┬а ┬а ┬а ┬а ┬а ┬а ЁЯСН рж╕рждрзНржп <span>${up}</span>
┬а ┬а ┬а ┬а </button>
┬а ┬а ┬а ┬а <button class="v-btn downvote ${userChoice === 'down' ? 'active-down': ''}" id="dbtn-${key}">
┬а ┬а ┬а ┬а ┬а ┬а ЁЯСО ржорж┐ржерзНржпрж╛ <span>${down}</span>
┬а ┬а ┬а ┬а </button>
┬а ┬а </div>

┬а ┬а <div class="comment-section">
<p id="kichukotha">${data.descriptiontopic}</p>
┬а ┬а </div>
</div>
`;

const handleVote = (type) => {
const oldChoice = localStorage.getItem(`choice_${key}`);
if (oldChoice === type) return; 

const updates = {};

if (oldChoice === 'up') updates['upvotes'] = increment(-1);
if (oldChoice === 'down') updates['downvotes'] = increment(-1);

if (type === 'up') updates['upvotes'] = increment(1);
if (type === 'down') updates['downvotes'] = increment(1);

update(ref(db, `iftar_places/${key}`), updates);
localStorage.setItem(`choice_${key}`, type);
};

div.querySelector(`#ubtn-${key}`).onclick = () => handleVote('up');
div.querySelector(`#dbtn-${key}`).onclick = () => handleVote('down');
marker.bindPopup(div);
};

onValue(ref(db, `iftar_places/${key}`), (s) => {
const val = s.val();
updatePopup(val.upvotes || 0, val.downvotes || 0);
});
});


const sheetBody = document.querySelector(".bottom-sheet .body");
const filterButtons = document.querySelectorAll(".toplineOfbottomsheet button");




function createIftarCard(data, distanceText = "") {
    return `
    <div class="iftar-card" style="width: 100%; height: auto; margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 10px; cursor: pointer;" onclick="window.zoomToMarker(${data.lat}, ${data.lng})">
        <div class="iftar-header">
            <div class="iftar-info">
                <h3 style="margin:0; font-size:16px; color:white;">${data.name}</h3>
                <p style="margin:2px 0; font-size:13px; color:white;">${data.isthanerNamearea}</p>
                ${distanceText}
                <p style="margin:2px 0; font-size:12px;">ЁЯУЕ рждрж╛рж░рж┐ржЦ: ${data.todaydate}</p>
                <p style="margin:2px 0; font-size:12px;">ЁЯН▒ <strong>ржорзЗржирзБ:</strong> ${data.iftariOption}</p>
            </div>
        </div>
    </div>`;
}





window.zoomToMarker = (lat, lng) => {
    map.setView([lat, lng], 17);
    hideBottomSheet();
};



async function loadFilteredData(filterType) {
    sheetBody.innerHTML = "<p style='text-align:center'>рж▓рзЛржб рж╣ржЪрзНржЫрзЗ...</p>";

    let userLat = null;
    let userLon = null;

    
    if (filterType === "Near by me") {
        try {
            const position = await new Promise((resolve, reject) => {
                navigator.geolocation.getCurrentPosition(resolve, reject, { timeout: 5000 });
            });
            userLat = position.coords.latitude;
            userLon = position.coords.longitude;
        } catch (error) {
            alert("рж▓рзЛржХрзЗрж╢ржи ржкрж╛ржУрзЯрж╛ ржпрж╛рзЯржирж┐ред ржЕржирзБржЧрзНрж░рж╣ ржХрж░рзЗ ржкрж╛рж░ржорж┐рж╢ржи ржЪрзЗржХ ржХрж░рзБржиред");
            sheetBody.innerHTML = "<p style='text-align:center; color:red;'>рж▓рзЛржХрзЗрж╢ржи ржПржХрзНрж╕рзЗрж╕ ржкрж╛ржУрзЯрж╛ ржпрж╛рзЯржирж┐ред</p>";
            
            return;
        }
    }

    
    onValue(placesRef, (snapshot) => {
        sheetBody.innerHTML = "";
        
    
        const now = new Date();
        const today = now.toISOString().split('T')[0];
        
        const tomorrowObj = new Date();
        tomorrowObj.setDate(now.getDate() + 1);
        const tomorrow = tomorrowObj.toISOString().split('T')[0];

        let results = [];

        snapshot.forEach((childSnapshot) => {
            const data = childSnapshot.val();
            
            data.key = childSnapshot.key; 
            
            let show = false;

    
            if (filterType === "ржЖржЬ" && data.todaydate === today) show = true;
            else if (filterType === "ржЖржЧрж╛ржорзАржХрж╛рж▓" && data.todaydate === tomorrow) show = true;
            else if (filterType === "ржкрж░рж╢рзБ" && data.todaydate > tomorrow) show = true;
            else if (filterType === "Near by me") show = true;

            if (show) {
                
                if (userLat && userLon && data.lat && data.lng) {
                    data.distance = getDistance(userLat, userLon, data.lat, data.lng);
                } else {
                    data.distance = Infinity;
                }
                results.push(data);
            }
        });

    
        if (filterType === "Near by me") {
            results.sort((a, b) => a.distance - b.distance);
        }

        
        if (results.length > 0) {
            results.forEach(item => {
                const distLabel = (item.distance && item.distance !== Infinity) ? 
                    `<p style='font-size:12px; color:#27ae60; font-weight:bold;'>ЁЯУН ржжрзВрж░рждрзНржм: ${item.distance.toFixed(2)} ржХрж┐ржорж┐ ржжрзВрж░рзЗ</p>` : "";
                
                sheetBody.innerHTML += createIftarCard(item, distLabel);
            });
        } else {
            sheetBody.innerHTML = `<p style='text-align:center; color:#666;'>"${filterType}" ржлрж┐рж▓рзНржЯрж╛рж░рзЗ ржХрзЛржирзЛ рждржерзНржп ржирзЗржЗред</p>`;
        }
    }, { onlyOnce: true });
}


// ржмрж╛ржЯржи ржХрзНрж▓рж┐ржХ рж╣рзНржпрж╛ржирзНржбрж▓рж╛рж░
filterButtons.forEach(btn => {
    btn.onclick = () => {
        
        filterButtons.forEach(b => b.style.opacity = "0.5");
        btn.style.opacity = "1";
        
        const type = btn.innerText.trim();
        loadFilteredData(type);
    };
});


loadFilteredData("ржЖржЬ");






document.getElementById('searchBtn').onclick = async () => {
const q = document.getElementById('searchInput').value;
const res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${q}, Pabna`);
const d = await res.json();
if (d.length > 0) map.setView([d[0].lat, d[0].lon], 16);
};









</script>

<script>
    
const showModalBtn = document.getElementById("fabbuttontwo");
const bottomSheet = document.querySelector(".bottom-sheet");
const sheetOverlay = bottomSheet.querySelector(".sheet-overlay");
const sheetContent = bottomSheet.querySelector(".content");
const dragIcon = bottomSheet.querySelector(".drag-icon");


let isDragging = false, startY, startHeight;


const showBottomSheet = () => {
    bottomSheet.classList.add("show");
    document.body.style.overflowY = "hidden";
    updateSheetHeight(50);
}

const updateSheetHeight = (height) => {
    sheetContent.style.height = `${height}vh`; 
    bottomSheet.classList.toggle("fullscreen", height === 100);
}

const hideBottomSheet = () => {
    bottomSheet.classList.remove("show");
    document.body.style.overflowY = "auto";
}

const dragStart = (e) => {
    isDragging = true;
    startY = e.pageY || e.touches?.[0].pageY;
    startHeight = parseInt(sheetContent.style.height);
    bottomSheet.classList.add("dragging");
}


const dragging = (e) => {
    if(!isDragging) return;
    const delta = startY - (e.pageY || e.touches?.[0].pageY);
    const newHeight = startHeight + delta / window.innerHeight * 100;
    updateSheetHeight(newHeight);
}


const dragStop = () => {
    isDragging = false;
    bottomSheet.classList.remove("dragging");
    const sheetHeight = parseInt(sheetContent.style.height);
    sheetHeight < 25 ? hideBottomSheet() : sheetHeight > 75 ? updateSheetHeight(100) : updateSheetHeight(50);
}

dragIcon.addEventListener("mousedown", dragStart);
document.addEventListener("mousemove", dragging);
document.addEventListener("mouseup", dragStop);

dragIcon.addEventListener("touchstart", dragStart);
document.addEventListener("touchmove", dragging);
document.addEventListener("touchend", dragStop);

sheetOverlay.addEventListener("click", hideBottomSheet);
showModalBtn.addEventListener("click", showBottomSheet);
</script>
<script>
    const inputElement = document.getElementById("searchInput");
const phrases = ["ржкрж╛ржмржирж╛рж░ ржХрзЛржирзЛ рж╕рзНржерж╛ржи ржЦрзБржБржЬрзБржи...", " ржкрж╛ржмржирж╛рж░ ржпрзЗржХрзЛржирзЛ ржПрж▓рж╛ржХрж╛ ржЦрзБржБржЬрзБржи...", " ржкрж╛ржмржирж╛рж░ ржпрзЗржХрзЛржирзЛ ржарж┐ржХрж╛ржирж╛ рж▓рж┐ржЦрзБржи..."]; 
let phraseIndex = 0;
let characterIndex = 0;
let isDeleting = false;
let typeSpeed = 150;

function typeEffect() {
  const currentPhrase = phrases[phraseIndex];
  
  if (isDeleting) {
    
    characterIndex--;
    typeSpeed = 80;
  } else {
    
    characterIndex++;
    typeSpeed = 150;
  }

  inputElement.setAttribute("placeholder", currentPhrase.substring(0, characterIndex));

  
  if (!isDeleting && characterIndex === currentPhrase.length) {
    isDeleting = true;
    typeSpeed = 1000; 
  } else if (isDeleting && characterIndex === 0) {
    isDeleting = false;
    phraseIndex = (phraseIndex + 1) % phrases.length; 
    typeSpeed = 300;
  }

  setTimeout(typeEffect, typeSpeed);
}


document.addEventListener("DOMContentLoaded", typeEffect);
</script>

<script>
    window.addEventListener("load", function() {
    const loader = document.getElementById("loader-wrapper");
    const content = document.getElementById("main-content");


  setTimeout(() => {
        loader.style.display = "none"; 
         
    }, 500); 
});
</script>

<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('sw.js')
        .then(reg => console.log('Service Worker Registered!'))
        .catch(err => console.log('Registration Failed', err));
    });
  }
</script>
</body>
</html>